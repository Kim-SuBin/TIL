# 제2절 DDL (Data Definition Language)

## 1. 데이터 유형

- 데이터 베이스의 테이블에 특정 자료를 입력할 때, 그 자료를 받아들일 공간을 자료의 유형별로 나누는 기준
- 특정 칼럼을 정의할 때 선언한 데이터 유형은 그 칼럼이 받아오는 자료의 유형 규정
- 선언한 유형이 아닌 다른 종류의 데이터가 들어오려고 하면 데이터베이스는 에러를 발생시킴
- 데이터 유형과 더불어 지정한 크기도 중요
- 선언 당시 지정한 데이터의 크기를 넘어선 자료가 입력되는 상황에도 에러 발생
- 자주 쓰이는 유형
    
    |데이터 유형|설명|
    |:---:|---|
    |CHARACTER(s)|- 고정 길이 문자열 정보 (Oracle, SQL Server 모두 Char 라고 표현)<br/>- s는 기본 길이 1바이트, 최대 길이 Oracle 2,000 바이트, SQL Server 8,000 바이트<br/>- s만큼 최대 길이를 갖고 고정 길이를 가지고 있으므로 할당된 변수 값의 길이가 s보다 작을 경우에는 그 차이 길이만큼 공간으로 채워짐|
    |VARCHAR(s)|- CHARACTER VARYING의 약자로, 가별 길이 문자열 정보 (Oracle은 VARCHAR2로 표현, SQL Server는 VARCHAR로 표현)<br/>- s는 최소 길이 1바이트, 최대 길이 Oracle 4,000 바이트, SQL Server 8,000 바이트<br/>- s만큼의 최대 길이를 갖지만 가변 길이로 조정되기 때문에 할당된 변수 값의 바이트만 적용됨 (Limit 개념)|
    |NUMERIC|- 정수, 실수 등 숫자 정보 (Oracle은 NUMBER으로 표현, SQL Server는 10 가지 이상의 숫자 타입 존재)<br/>- Oracle은 처음에 전체 자리 수를 지정하고, 그 다음 소수 부분 자리 수 지정 (NUMBER(8, 2)인 경우 정수 6자리, 소수 2자리)|
    |DATETIME|- 날짜와 시각 정보 (Oracle은 Date로 표현, SQL Server는 DATETIME으로 표현)<br/>- Oracle은 1초 단위, SQL Server는 3.33ms (millisecond) 단위 관리|

- 고정 길이를 가지지 않는다면 VARCHAR로 입력하는 것이 바람직
- VAHCAHR 유형의 경우, 맨 처음부터 한 문자씩 비교하며 공백도 하나의 문자로 취급하기 때문에 끝에 공백이 있는 경우 다른 문자로 취급

    'AA' ≠ 'AA '

    ( CHAR의 경우 'AA' = 'AA ' )

## 2. CREATE TABLE

### 1. 테이블과 칼럼 정의

- 테이블에 존재하는 모든 데이터를 고유하게 식별할 수 있으며 반드시 값이 존재하는 단일 칼럼이나 칼럼의 조합들 (후보키) 중 하나를 선정하여 기본키 칼럼으로 지정
- 기본키는 단일 칼럼이 아닌 여러 개의 칼럼으로도 생성 가능
- 테이블과 테이블 간 정의된 관계는 기본키(PK), 외부키(FK)를 활용하여 설정

### 2. CREATE TABLE

- 테이블 생성 구문 형식

    ```sql
    CREATE TABLE 테이블이름 (
        칼럼명1 DATATYPE [DEFAULT형식],
        칼럼명2 DATATYPE [DEFAULT형식].
        칼럼명3 DATATYPE [DEFAULT형식]
    ) ;
    ```

- 테이블 생성 시 주의사항
    - 테이블명은 객체를 의미할 수 있는 적절한 이름 사용 (가능한 단수형 권고)
    - 테이블명은 다른 테이블명과 중복 불가
    - 한 태이블 내에서는 칼럼명 중복 불가
    - 테이블 이름 지정 후 각 칼럼들은 괄호 "()"로 묶어서 지정
    - 각 칼럼들은 콤마 "," 로 구분
    - 테이블 생성문 끝은 항상 세미콜론 ";"
    - 각 칼럼에 대해서 다른 테이블까지 고려하여 데이터베이스 내에서는 일관성 있게 사용하는 것이 좋음 (데이터 표준화 관점)
    - 칼럼 뒤에 데이터 유형 지정 필요
    - 테이블명과 칼럼명은 반드시 문자로 시작해야 하며, 벤더별로 길이 한계 있음
    - 벤더에서 사전에 정의한 예약어는 사용 불가
    - A-Z, a-z, 0-9, _, $, # 문자만 허용
    - 테이블 생성 시 대/소문자 구분은 하지 않음 (기본적으로 대문자로 생성됨)
    - DATETIME 데이터 유형은 별도로 크기 지정 X
    - 문자 데이터 유형은 반드시 최대 길이를 표시해야 함
    - 칼럼과 칼럼 구분은 콤마로 하되, 마지막 칼럼은 콤마를 찍지 않음
    - 칼럼 제약 조건은 CONSTRAINT를 이용하여 추가

### 3. 제약 조건 (CONSTRAINT)

- 사용자가 원하는 조건의 데이터만 유지하기 위한 즉, 데이터 무결성을 유지하기 위한 데이터베이스의 보편적인 방법
- 테이블의 특정 칼럼에 설정하는 제약
- 제약 조건 종류

    |구분|설명|
    |:---:|---|
    |PRIMARY KEY (기본키)|- 테이블에 저장된 행 데이터를 고유하게 식별하기 위한 기본키 정의<br/>- 하나의 테이블에 하나의 기본키 제약만 정의 가능<br/>- 기본키 제약 = 고유키 제약 & NOT NULL 제약|
    |UNIQUE KEY (고유키)|- 테이블에 저장된 행 데이터를 고유하게 식별하기 위한 고유키 정의<br/>- NULL 값을 가지더라도 고유키 제약에 위반되지 않음|
    |NOT NULL|- NULL 값 입력 금지<br/>- 디폴트 상태에서는 모든 칼럼에서 NULL 허가<br/>- CHECK의 일부분으로 이해할 수도 있음|
    |CHECK|- 입력할 수 있는 값의 범위 제약<br/>- TRUE or FALSE로 평가할 수 있는 논리식 지정|
    |FOREIGN KEY (외래키)|- 관계형 데이터베이스에서 테이블 간 관계 정의를 위해 기본키를 다른 테이블로 복사하는 경우 외래키가 생성됨<br/>- 외래키 지정시 참조 무결성 제약 옵션 선택 가능|

- NULL :
    - 아직 정의되지 않은 미지의 값
    - 현재 데이터를 입력하지 못하는 경우
- DEFAULT :
    - 칼럼의 값이 지정되어 있지 않을 경우 기본값을 사전에 설정 가능
    - 데이터 입력 시 명시된 값을 지정하지 않은 경우 NULL 값이 입력되고, DEFAULT 값을 정의했다면 해당 칼럼에 정의된 기본값이 자동으로 입력됨

### 4. 생성된 테이블 구조 확인

- Oracle의 경우 "DESCRIBE 테이블명;" 또는 "DESC 테이블명;"으로 해당 테이블에 대한 정보 확인 가능
- SQL Server의 경우 "sp_help 'dbo.테이블명'"으로 해당 테이블에 대한 정보 확인 가능

### 5. SELECT 문장을 통한 테이블 생성 사례

- 다음 절에서 배울 DML 문장 중 하나인 SELECT 문장을 활용해 테이블을 생성할 수 있는 방법(CTAS : Create Table ~ As Select ~)이 있음
- 기존 테이블을 이용한 CTAS 방법의 장점은 칼럼별 테이블 유형을 재정의하지 않아도 된다는 것
- 주의할 점은 기본 테이블의 제약 조건 중 NOT NULL만 새로운 복제 테이블에 적용되고, 기본키, 고유키, 외래키, CHECK 등 다른 제약 조건은 없어짐
- 제약 조건 추가를 위해 ALTER TABLE 기능을 사용해야 함
- SQL Server에서는 Select ~ Into ~ 를 활용하여 위와 같은 겨로가를 얻을 수 있음
- 칼럼 속성에 Identity를 사용했다면 Identity 속성까지 같이 적용됨

## 3. ALTER TABLE

- 업무적인 요구사항이나 시스템 운영상 테이블을 사용하는 도중 변경 사항이 발생할 때 사용
- 주로 칼럼 추가/삭제, 제약 조건 추가/삭제하는 작업 진행

### 1. ADD COLUMN

```sql
ALTER TABLE 테이블명
ADD 추가할칼럼명 데이터유형;
```

- 기존 테이블에 필요한 칼럼을 추가하는 명령어
- 새롭게 추가된 칼럼은 테이블의 마지막 칼럼이되며 칼럼의 위치를 지정할 수 없음

### 2. DROP COLUMN

```sql
ALTER TABLE 테이블명
DROP COLUMN 삭제할칼럼명;
```

- 필요없는 칼럼 삭제
- 데이터가 있든 없든 모두 삭제
- 한 번에 하나의 칼럼만 삭제 가능
- 칼럼 삭제 후 최소 하나 이상의 칼럼이 테이블에 존재해야 함
- 한 번 삭제된 칼럼은 복구 불가

### 3. MODIFY COLUMN

- 칼럼의 데이터 유형, 디폴트 값, NOT NULL 제약조건에 대한 변경

```sql
[Oracle]
ALTER TABLE 테이블명
MODIFY (칼럼명1 데이터유형 [DEFAULT 식] [NOT NULL], 칼럼명2 데이터유형 ...);
```

```sql
[SQL Server]
ALTER TABLE 테이블명
ALTER (칼럼명1 데이터유형 [DEFAULT 식] [NOT NULL], 칼럼2 데이터유형 ...);
```

- 고려할 사항
    - 해당 칼럼의 크기는 늘릴 수 있지만 줄일 수 없음 (줄이면 기존 데이터가 훼손될 수 있기 때문)
    - 해당 칼럼이 NULL 값을 가지고 있거나 테이블에 아무 행이 없으면 칼럼의 폭을 줄일 수 있음
    - 해당 칼럼이 NULL 값만 가지고 있으면 데이터 유형 변경 가능
    - 해당 칼럼의 DEFAULT 값을 바꾸면 변경 작업 이후 발생하는 행 삽입에만 영향을 미침
    - 해당 칼럼에 NULL 값이 없을 경우 NOT NULL 제약 조건 추가 가능

### 4. RENAME COLUMN

- 칼럼명을 어떤 이유로 불가피하게 변경해야 하는 경우 사용
- Oracle 등 일부 DBMS에서만 지원하는 기능

```sql
ALTER TABLE 테이블명
RENAME COLUMN 기존칼럼명 TO 새로운칼럼명;
```

- SQL Server에서는 sp_rename 저장 프로시저를 이용하여 칼럼 이름 변경 가능

```sql
sp_rename 기존칼럼명, 새로운칼럼명, 'COLUMN';
```

### 5. DROP COLUMN

- 테이블 생성 시 부여했던 제약조건을 삭제하는 명령어

```sql
ALTER TABLE 테이블명 DROP CONSTRAINT 제약조건명;
```

### 6. ADD CONSTRAINT

- 생성 이후에 필요에 의해 제약조건을 추가하는 경우 사용

```sql
ALTER TABLE 테이블명
ADD CONSTRAINT 제약조건명 제약조건 (칼럼명);
```

## 4. RENAME TABLE

- 테이블 이름 변경

```sql
RENAME 기존테이블명 TO 새로운테이블명;
```

- SQL Server에서는 sp_rename을 이용하여 테이블명 변경

```sql
sp_rename 기존테이블명, 새로운테이블명
```

## 5. DROP TABLE

- 테이블 삭제

```sql
DROP TABLE 테이블명 [CASCADE CONSTRAINT];
```

- 테이블의 모든 데이터 및 구조 삭제
- CASCADE CONSTRAINT 옵션은 해당 테이블과 관계가 있던 참조되는 제약조건에 대해서도 삭제한다는 것을 의미
- SQL Server에서는 CASCADE 옵션이 존재하지 않으면 테이블 삭제 전 참조하는 FK 제약 조건 또는 참조 테이블을 먼저 삭제해야 함

## 6. TRUNCATE TABLE
```sql
TRUNCATE TABLE 테이블명;
```

- 테이블 자체가 삭제되는 것이 아닌 해당 테이블이 들어있던 모든 행들이 제거되고 저장 공간을 재사용 가능하도록 해제
- 정상적인 복구가 불가능하므로 주의해야 함

> 본 포스팅은 SQL 개발자 가이드를 참고하여 작성되었습니다.