# 제5절 데이터베이스 구조와 성능

## 1. 슈퍼타입/서브타입 모델의 성능 고려 방법

### 1. 슈퍼/서브타입 데이터 모델 개요

- 슈퍼/서브타입 데이터 모델은 Extended ER 모델이라고도 함
- 데이터 특징을 공통과 차이점을 고려하여 효과적으로 표현할 수 있어 자주 쓰임
- 공통 부분을 슈퍼타입으로 모델링하고 공통으로부터 상속받아 다른 엔티티와 차이가 있는 속성에 대해 별도의 서브엔티티로 구분하여 업무의 모습을 정확하게 표현
- 물리적인 데이터 모델로 변환할 때 선택이 폭을 넓힐 수 있음
- 분석단계에서 많이 쓰이는 모델

### 2. 슈퍼/서브타입 데이터 모델의 변환 시 성능이 저하되는 경우

1. 트랜잭션은 항상 일괄로 처리하는 데 테이블은 개별로 유지되어 Union 연산에 의해 성능이 저하될 수 있음
2. 트랜잭션은 항상 서브타입을 개별로 처리하는 데 테이블은 하나로 통합되어 잇어 불필요하게 많은 양의 데이터가 집약되어 있는 경우
3. 트랜잭션은 항상 슈퍼+서브 타입을 공통으로 처리하는 데 개별로 유지되어 잇거나 하나의 테이블로 집약되어 있는 경우

### 3. 슈퍼/서브타입 데이터 모델의 변환 기술

1. 개별로 발생되는 트랜잭션에 대해서는 개별 테이블로 구성
2. 슈퍼타입+서브타입에 대해 발생되는 트랜잭션에 대해서는 슈퍼타입+서브타입 테이블로 구성
3. 전체를 하나로 묶어 트랜잭션이 발생할 때는 하나의 테이블로 구성

### 4. 슈퍼/서브타입 데이터 모델 변환 타입 비교

|구분|OneToOne Type|Plus Type|Single Type|
|:---:|:---:|:---:|:---:|
|특징|개별 테이블 유지|슈퍼+서브타입 테이블|하나의 테이블|
|확장성|우수|보통|나쁨|
|조인 성능|나쁨|나쁨|우수|
|I/O량 성능|좋음|좋음|나쁨|
|관리용이성|좋지않음|좋지않음|좋음 (1개)|
|트랜잭션 유형에 따른 선택 방법|개별 테이블로 접근이 많은 경우|슈퍼+서브 형식으로 데이터를 처리하는 경우|전체를 일괄적으로 처리하는 경우|

## 2. 인덱스 특성을 고려한 PK/FK 데이터베이스 성능 향상

### 1. PK/FK 칼럼 순서와 성능 개요

- 인덱스 : 데이터를 조회할 때 가장 효과적으로 처리될 수 있도록 접근 경로를 제공하는 오브젝트
- 데이터베이스 테이블에서는 균형 잡힌 트리 구조인 B*Tree 구조 많이 사용
- PK는 해당 테이블의 데이터를 접근할 때 가장 빈번하게 사용되는 유일한 인덱스를 모두 자동 생성
- 데이터 모델링 때 결정한 PK 순서와 다르게, DDL 문장을 통해 PK 순서를 다르게 생성할 수 있음
- FK라고 하더라도 데이터 조회 시 조인 경로를 제공하는 역할을 수행하므로 인덱스 생성 필수

### 2. PK 칼럼의 순서를 조정하지 않으면 성능 저하가 발생하는 이유

PK 순서를 인데스 특징에 맞게 고려하지 않고 그대로 생성하게 되면, 테이블에 접근하는 트랜잭션의 특징에 효율적이지 않은 인덱스가 생성되어 인덱스 범위가 넓어지거나 Full Scan을 유발하게 되어 성능이 저하됨

### 3. PK 순서를 잘못 지정하여 성능이 저하된 경우 - 간단한 오류

데이터가 200만건 존재하는 학원 수강생에 대한 테이블을 **수험번호+년도+학기**로 구성한 경우

⇒ Full Table Scan 발생

→ **년도+학기+수험번호** 순으로 인덱스를 수정하면 평균 2만 건 데이터 처리

### 4. PK 순서를 잘못 지정하여 성능이 저하된 경우 - 복잡한 오류

사무실의 거래 내역을 저장한 테이블에 대해 **거래일자+사무실코드**로 구성한 경우

특정 날짜에 대한 특정 사무실의 거래 내역을 받아올 때 모든 사무실의 거래 내역을 받아온 후 특정 사무실의 거래 내역을 찾으므로 **넓은 범위 조회로 인한 성능 저하 발생**

→ **사무실코드+거래일자**로 구성한 경우 특정 사무실을 먼저 받아온 후 거래 날짜를 찾으므로 **조회 범위가 좁아져 성능이 향상됨**

## 3. 물리적인 테이블에 FK 제약이 걸려있지 않을 경우 인덱스 미생성으로 인한 성능 저하

- FK 인덱스를 적절하게 설계하여 구축하지 않았을 경우 데이터량이 누적됨에 따라 SQL 성능이 나빠져 데이터베이스 서버에 심각한 장애 현상을 초래하는 경우가 많음
- 물리적인 테이블에 FK 제약을 걸었을 때 반드시 FK 인덱스 생성
- FK 제약이 걸리지 않았을 때 FK 인덱스 생성은 기본 정책으로 하되 거의 활용되지 않을 경우 FK 인덱스를 지우는 것이 좋음

> 본 포스팅은 SQL 개발자 가이드를 참고하여 작성되었습니다.